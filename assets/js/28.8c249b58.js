(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{205:function(e,t,n){"use strict";n.r(t);var r=n(0),o=Object(r.a)({},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"content"},[e._m(0),e._v(" "),e._m(1),e._v(" "),e._m(2),e._v(" "),n("blockquote",[n("p",[e._v("Source Code: "),n("a",{attrs:{href:"https://github.com/dotnet/corefx/blob/master/src/System.Linq/src/System/Linq/GroupJoin.cs",target:"_blank",rel:"noopener noreferrer"}},[e._v("GroupJoin.cs"),n("OutboundLink")],1)])]),e._v(" "),e._m(3),e._v(" "),e._m(4),e._v(" "),e._m(5),e._v(" "),e._m(6),e._v(" "),e._m(7),e._m(8),e._v(" "),e._m(9),e._v(" "),e._m(10),e._v(" "),e._m(11),e._v(" "),e._m(12),e._v(" "),n("ul",[n("li",[e._v("Source Code: "),n("a",{attrs:{href:"https://github.com/dotnet/corefx/blob/master/src/System.Linq/tests/GroupJoinTests.cs",target:"_blank",rel:"noopener noreferrer"}},[e._v("GroupJoinTests.cs"),n("OutboundLink")],1)])]),e._v(" "),e._m(13),e._v(" "),e._m(14),e._m(15),e._v(" "),e._m(16),e._v(" "),e._m(17),e._m(18),e._v(" "),e._m(19),e._v(" "),e._m(20),e._v(" "),e._m(21),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://github.com/dotnet/corefx",target:"_blank",rel:"noopener noreferrer"}},[e._v("dotnet/corefx"),n("OutboundLink")],1)])])])},[function(){var e=this.$createElement,t=this._self._c||e;return t("h1",{attrs:{id:"groupjoin的原碼探索"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#groupjoin的原碼探索","aria-hidden":"true"}},[this._v("#")]),this._v(" GroupJoin的原碼探索")])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("p",[e._v("今天要來看"),n("code",[e._v("GroupJoin")]),e._v("的內部實作，知道"),n("code",[e._v("GroupJoin")]),e._v("的使用方式後，應該不難猜出它的實作可能跟"),n("code",[e._v("Join")]),e._v("很相似: 因為"),n("code",[e._v("GroupJoin")]),e._v("主要還是做"),n("code",[e._v("Join")]),e._v("的動作，只是最後加了個"),n("code",[e._v("resultSeletor")]),e._v("讓它可以對每個鍵值做"),n("strong",[e._v("彙整")]),e._v("，現在來看看是不是真的是這樣吧。")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"原始碼分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#原始碼分析","aria-hidden":"true"}},[this._v("#")]),this._v(" 原始碼分析")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("如往常一樣，我們來看一下"),t("code",[this._v("GroupJoin")]),this._v("的公開方法，再一次的如同之前"),t("code",[this._v("Join")]),this._v("的原始碼，這裡只做了兩件事:")])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ul",[n("li",[n("strong",[e._v("檢查傳入參數")]),e._v("是否為空，如果是空的拋出"),n("code",[e._v("ArgumentNull")]),e._v("例外")]),e._v(" "),n("li",[e._v("所有參數皆合法的話叫用"),n("code",[e._v("GroupJoinIterator")]),e._v("取得"),n("code",[e._v("Iterator")]),e._v("之後回傳")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("其實在"),t("em",[this._v("System.Linq")]),this._v("專案中的公開方法都是這樣做處理的，只有做檢查參數的動作，接著就丟給其他"),t("strong",[this._v("Method")]),this._v("做事，以後如果沒有其他特別的處理，都會像上面一樣用文字說明，就不再貼原始碼了。")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("接著我們來看一下"),t("code",[this._v("GroupJoinIterator")]),this._v("的實作:")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language-C# extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("private static IEnumerable<TResult> GroupJoinIterator<TOuter, TInner, TKey, TResult>(\n    IEnumerable<TOuter> outer,\n    IEnumerable<TInner> inner,\n    Func<TOuter, TKey> outerKeySelector,\n    Func<TInner, TKey> innerKeySelector,\n    Func<TOuter, IEnumerable<TInner>, TResult> resultSelector,\n    IEqualityComparer<TKey> comparer)\n{\n    using (IEnumerator<TOuter> e = outer.GetEnumerator())\n    {\n        if (e.MoveNext())\n        {\n            Lookup<TKey, TInner> lookup = Lookup<TKey, TInner>.CreateForJoin(inner, innerKeySelector, comparer);\n            do\n            {\n                TOuter item = e.Current;\n                yield return resultSelector(item, lookup[outerKeySelector(item)]);\n            }\n            while (e.MoveNext());\n        }\n    }\n}\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("這邊可以看到跟"),t("code",[this._v("JoinIterator")]),this._v("很像的實作，差別在於下面兩點:")])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ul",[n("li",[e._v("未檢查"),n("code",[e._v("inner")]),e._v("是否有值就叫傳入"),n("code",[e._v("resultSelector")]),e._v("作結果輸出")]),e._v(" "),n("li",[e._v("沒有對"),n("code",[e._v("inner")]),e._v("再做一次迴圈，而是直接把整包"),n("code",[e._v("inner")]),e._v("丟給"),n("code",[e._v("resultSelector")])])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("p",[e._v("第一點是"),n("code",[e._v("GroupJoin")]),e._v("是"),n("strong",[e._v("Left Join")]),e._v("的原因，在沒有"),n("code",[e._v("inner")]),e._v("資料的情況下還是會執行"),n("code",[e._v("yield return")]),e._v("，就算只有"),n("code",[e._v("outer")]),e._v("的資料也可以回傳。")])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("p",[e._v("第二點是"),n("code",[e._v("GroupJoin")]),e._v("可以"),n("strong",[e._v("彙整")]),e._v("資料的原因，因為沒有做迴圈，所以丟給"),n("code",[e._v("resultSelector")]),e._v("的是"),n("code",[e._v("inner")]),e._v("的"),n("strong",[e._v("集合")]),e._v("資料，所以可以用集合資料來做"),n("strong",[e._v("彙整")]),e._v("。")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"測試案例賞析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#測試案例賞析","aria-hidden":"true"}},[this._v("#")]),this._v(" 測試案例賞析")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"outerinnerbothsinglenullelement"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#outerinnerbothsinglenullelement","aria-hidden":"true"}},[this._v("#")]),this._v(" OuterInnerBothSingleNullElement")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language-C# extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("[Fact]\npublic void OuterInnerBothSingleNullElement()\n{\n    string[] outer = new string[] { null };\n    string[] inner = new string[] { null };\n    string[] expected = new string[] { null };\n\n    Assert.Equal(expected, outer.GroupJoin(inner, e => e, e => e, (x, y) => x, EqualityComparer<string>.Default));\n    Assert.Empty(outer.Join(inner, e => e, e => e, (x, y) => x, EqualityComparer<string>.Default));\n}\n")])])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("p",[e._v("這裡我們可以看到"),n("code",[e._v("inner")]),e._v("跟"),n("code",[e._v("outer")]),e._v("是有一個"),n("code",[e._v("null")]),e._v("的字串陣列，可是他還是會回傳有一個"),n("code",[e._v("null")]),e._v("的字串陣列，可是"),n("code",[e._v("Join")]),e._v("就會傳回空。")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"selectorsreturnnull"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#selectorsreturnnull","aria-hidden":"true"}},[this._v("#")]),this._v(" SelectorsReturnNull")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language-C# extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('[Fact]\npublic void SelectorsReturnNull()\n{\n    CustomerRec[] outer = new []\n    {\n        new CustomerRec{ name = "Tim", custID = null },\n        new CustomerRec{ name = "Bob", custID = null }\n    };\n    OrderRec[] inner = new []\n    {\n        new OrderRec{ orderID = 97865, custID = null, total = 25 },\n        new OrderRec{ orderID = 34390, custID = null, total = 19 }\n    };\n    JoinRec[] expected = new []\n    {\n        new JoinRec{ name = "Tim", orderID = new int?[]{ }, total = new int?[]{ } },\n        new JoinRec{ name = "Bob", orderID = new int?[]{ }, total = new int?[]{ } }\n    };\n\n    Assert.Equal(expected, outer.GroupJoin(inner, e => e.custID, e => e.custID, createJoinRec));\n}\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("在鍵值為"),t("code",[this._v("null")]),this._v("的情形下會拿不到"),t("code",[this._v("inner")]),this._v("的資料，可是"),t("code",[this._v("outer")]),this._v("的資料依然可以輸出。")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"結語"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#結語","aria-hidden":"true"}},[this._v("#")]),this._v(" 結語")])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("p",[e._v("這次賞析的"),n("code",[e._v("GroupJoin")]),e._v("跟"),n("code",[e._v("Join")]),e._v("大同小異，最大的差別就在於"),n("code",[e._v("GroupJoin")]),e._v("可以不用"),n("code",[e._v("inner")]),e._v("的資料也可以輸出，這也是造成"),n("code",[e._v("GroupJoin")]),e._v("是"),n("strong",[e._v("Left Join")]),e._v("的原因，另外也因為"),n("code",[e._v("GroupJoin")]),e._v("沒有再做迴圈巡覽"),n("code",[e._v("inner")]),e._v("就輸出給"),n("code",[e._v("resultSeletor")]),e._v("做處理，所以可以直接"),n("strong",[e._v("彙整")]),e._v("每個鍵值的資料，跟"),n("code",[e._v("Join")]),e._v("在用途及情境上就有差異了。")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"參考"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#參考","aria-hidden":"true"}},[this._v("#")]),this._v(" 參考")])}],!1,null,null,null);t.default=o.exports}}]);